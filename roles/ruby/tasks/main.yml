---

- name: Ruby dependencies
  become: true
  apt:
    name: "{{item}}"
    state: latest
  with_items:
    - build-essential
    - zlib1g-dev
    - libyaml-dev
    - libssl-dev
    - libgdbm-dev
    - libreadline-dev
    - libncurses5-dev
    - libffi-dev

- name: Create local src folder
  file:
    dest: ~/.local/src
    state: directory

- name: Download rbenv
  get_url:
    url: "{{rbenv_url}}"
    dest: ~/.local/src/{{rbenv_archive}}

- name: Extract rbenv
  unarchive:
    src: ~/.local/src/{{rbenv_archive}}
    dest: ~/.local/src
    creates: ~/.local/src/rbenv-{{rbenv_version}}

- name: Install rbenv
  synchronize:
    src: ~/.local/src/rbenv-{{rbenv_version}}/
    dest: ~/.rbenv

- name: Create rbenv plugins folder
  file:
    dest: ~/.rbenv/plugins
    state: directory

- name: Download ruby-build
  get_url:
    url: "{{ruby_build_url}}"
    dest: ~/.local/src/{{ruby_build_archive}}

- name: Extract ruby-build
  unarchive:
    src: ~/.local/src/{{ruby_build_archive}}
    dest: ~/.local/src
    creates: ~/.local/src/ruby-build-{{ruby_build_version}}

- name: Install ruby-build
  synchronize:
    src: ~/.local/src/ruby-build-{{ruby_build_version}}/
    dest: ~/.rbenv/plugins/ruby-build
